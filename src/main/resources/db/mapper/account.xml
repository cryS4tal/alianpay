<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ylli.api.auth.mapper.AccountMapper">
    <resultMap id="mchMap" type="com.ylli.api.mch.model.Mch"/>

    <select id="selectByQuery" resultMap="mchMap">
        SELECT
        t_account.id AS 'mch_id',
        t_user_base.mch_name,
        t_user_base.link_phone AS 'phone',
        t_user_base.state AS 'audit_state',
        t_account.state AS 'mch_state'
        FROM
        t_account
        LEFT JOIN t_user_base ON t_account.id = t_user_base.mch_id
        <where>
            <if test="mch_name != null">
                <bind name="name_like_ext" value="mch_name + '%'"/>
                t_user_base.mch_name LIKE #{name_like_ext}
            </if>
            <if test="phone != null">
                AND (t_user_base.link_phone = #{phone} OR t_user_base.legal_phone = #{phone})
            </if>
            <if test="mch_id != null">
                AND t_account.id = ${mch_id}
            </if>
            <if test="audit_state != null">
                AND t_user_base.state = ${audit_state}
            </if>
            <if test="mch_state != null">
                AND t_account.state = #{mch_state}
            </if>
        </where>
        ORDER BY t_user_base.state DESC
    </select>
</mapper>